@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@(Html.Kendo().Grid<CategoryLang>().Name("CategoryGrid")
.ToolBar(toolbar => toolbar.Create().Text(@StoreOnLine.Resources.Resources.CategoryCreate))
.Events(events => events.Edit("EditCaption"))
.Events(e => e.DataBound("onRowBound"))
.Columns(columns =>
{
    columns.Bound(p => p.Id).Width(12);
    columns.Bound(p => p.Name).Width(50);
    columns.Bound(p => p.Description).Width(100);
    columns.Bound(p => p.Active).Width(40);
    columns.Command(comand =>
    {
        comand.Edit();
        comand.Destroy();
    }).Width(50);
})
.Editable(editable => editable.Mode(GridEditMode.PopUp).TemplateName("EditCategoryLang"))
.Pageable()
.Sortable()
.Scrollable()
.HtmlAttributes(new { style = "height:430px;" })
.DataSource(dataSource => dataSource
    .Ajax()
    .ServerOperation(false)
    .PageSize(15)
    .Events(events => events.Error("error_handler"))
    .Model(model => model.Id(p => p.Id))
    .Create(c => c.Action("Create", "Category"))
    .Read(r => r.Action("Read", "Category"))
    .Update(u => u.Action("Update", "Category"))
    .Destroy(d => d.Action("Delete", "Category"))
    )
)

@section Scripts
{
    <script type="text/javascript">
        function error_handler(e) {
            if (e.errors) {
                var message = "Errors:\n";
                $.each(e.errors, function (key, value) {
                    if ('errors' in value) {
                        $.each(value.errors, function () {
                            message += this + "\n";
                        });
                    }
                });
                alert(message);
            }
        };

        function EditCaption(e) {
            $('.k-window-title').text('@StoreOnLine.Resources.Resources.CategoryCreate');
            $('.k-grid-update').text('@StoreOnLine.Resources.Resources.CategoryEdit');
            $('.k-grid-cancel').text('@StoreOnLine.Resources.Resources.CategoryCancel');
        };

        function onRowBound(e) {
            $(".k-grid-edit").find("span").addClass("k-icon k-edit");
            $(".k-grid-Delete").find("span").addClass("k-icon k-delete");
            $(".k-grid-View").find("span").addClass("k-icon km-view");
        }
    </script>
}